###Https

###作用
1. 认证用户和服务器，确保数据发送到正确的客户机和服务器；(验证证书)
2. 加密数据以防止数据中途被窃取；（加密）
3. 维护数据的完整性，确保数据在传输过程中不被改变。（摘要算法）

###一、期望
1. 所有信息都是加密传播，第三方无法窃听。
2. 具有校验机制，一旦被篡改，通信双方会立刻发现。
3. 配备身份证书，防止身份被冒充。

###二、https握手过程
<img src="images/https_handshake.png" />

1. ClientHello: 客户端（通常是浏览器）先向服务器发出加密通信的请求
   + 支持的协议版本，比如TLS 1.0版。
   + 一个客户端生成的随机数，稍后用于生成"对话密钥"。
   + 支持的加密方法，比如RSA公钥加密。
   + 支持的压缩方法。  
   
2. ServerHello: 服务器收到客户端请求后，向客户端发出回应
   + 确认使用的加密通信协议版本，比如TLS 1.0版本。如果浏览器与服务器支持的版本不一致，服务器关闭加密通信。
   + 一个服务器生成的随机数，稍后用于生成"对话密钥"。
   + 确认使用的加密方法，比如RSA公钥加密。
   + 服务器证书。
   + 除了上面这些信息，如果服务器需要确认客户端的身份，就会再包含一项请求，要求客户端提供"客户端证书"
   
3. 客户端回应:首先验证服务器证书。如果证书不是可信机构颁布、或者证书中的域名与实际域名不一致、或者证书已经过期，就会向访问者显示一个警告，由其选择是否还要继续通信。如果证书没有问题，客户端就会从证书中取出服务器的公钥。然后，向服务器发送下面三项信息。
   + 一个随机数。该随机数用服务器公钥加密，防止被窃听。
   + 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。
   + 客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验。
   
4. 服务器的最后回应：服务器收到客户端的第三个随机数pre-master key之后，计算生成本次会话所用的"会话密钥"。然后，向客户端最后发送下面信息。
   + 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送。
   + 服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供客户端校验。
   + 整个握手阶段全部结束。接下来，客户端与服务器进入加密通信，就完全是使用普通的HTTP协议，只不过用"会话密钥"加密内容。

<img src="images/handshake.gif"/>

###参考
1. [SSL/TLS协议运行机制的概述](http://www.ruanyifeng.com/blog/2014/02/ssl_tls.html?20141021103852)